//Booking - Create
const createBookingDOM = (data) => {
    const bookingType = [];
    for (const tmp in data.bookingTypes) {
        bookingType.push({ id: +tmp, name: data.bookingTypes[tmp] });
    };
    const today = new Date();
    const addDays = 2;
    const nextDay = new Date().setDate(today.getDate() + addDays);
    return `
    <div class="row mb-7">
        <!--begin::Col-->
        <div class="col-xl-6 form-group fv-row">
            <label class="control-label fs-6 fw-bold mb-2">Mã đơn hàng</label>
            <input name="Code" class="form-control form-control-solid mb-3 mb-lg-0"  autoComplete="off" value="${data.code}" placeholder="Mã đặt chỗ" readonly/>
        </div>
        <!--end::Col-->
        <!--begin::Col-->
        <div class="col-xl-6 form-group fv-row">
            <label class="control-label fs-6 fw-bold mb-2">Khách hàng</label>
             <a class="text-primary ms-auto mx-2" tooltip="Thêm mới" data-bs-stacked-modal="#modal-create-customer" onclick="CreateCustomerBooking();this.onclick = null;">
               [+]
            </a>
            <select name="CustomerID" class="form-select form-select-solid" data-control="booking-create-select2">
                <option value="">Chọn khách hàng</option>
                ${buildOptions(data.customers, 'id', 'filterName')}
            </select>
        </div>
        <!--end::Col-->
    </div>
    <div class="row mb-7">
        <!--begin::Col-->
        <div class="col-xl-6 fv-row">
             <label class="control-label fs-6 fw-bold mb-2">Loại đơn</label>
             <select name="BookingType" data-control="booking-create-select2" class="form-select form-select-solid">
                 <option value="">Loại đơn</option>
                 ${buildOptions(bookingType, 'id', 'name')}
             </select>
        </div>
        <!--end::Col-->
        <!--begin::Col-->
        <div class="col-xl-6 fv-row">
            <label class="control-label fs-6 fw-bold mb-2">Điểm đến</label>
            <select name="DestinationID" data-control="booking-create-select2" class="form-select form-select-solid">
                <option value="">Chọn điểm đến</option>
                ${buildOptions(data.destinations, 'id', 'name')}
            </select>
        </div>
        <!--end::Col-->
    </div>
    <div class="row mb-7 fv-row">
        <!--begin::Col-->
        <div class="col-xl-6">
             <label class="control-label fs-6 fw-bold mb-2">Ngày khởi hành</label>
             <input name="DepartureDay" class="form-control form-control-solid mb-3 mb-lg-0" data-date-time="flatpickr"  type="text" value="${formatDateTimeV2(today)}"/>
        </div>
        <!--end::Col-->
        <!--begin::Col-->
        <div class="col-xl-6 fv-row">
             <label class="control-label fs-6 fw-bold mb-2">Ngày về</label>
             <input name="EndDate" class="form-control form-control-solid mb-3 mb-lg-0" data-date-time="flatpickr" type="text" value="${formatDateTimeV2(nextDay)}"/>
        </div>
        <!--end::Col-->
    </div>
    <div class="row mb-7">
        <!--begin::Col-->
        <div class="col-xl-6">
             <label class="control-label fs-6 fw-bold mb-2">Chọn nguồn khách</label>
             <select name="SourceID" class="form-select form-select-solid" data-control="booking-create-select2" data-items="create-booking-sourceId">
                 <option value="" >Chọn nguồn khách</option>
                 ${buildOptions(data.sources, 'id', 'name')}
             </select>
        </div>
        <!--end::Col-->
        <!--begin::Col-->
        <div class="col-xl-6">
             <label class="control-label fs-6 fw-bold mb-2">Liên kết nguồn</label>
             <input name="Link" class="form-control form-control-solid mb-3 mb-lg-0" data-items="create-booking-link-by-sourceId" autocomplete="off"/>
        </div>
        <!--end::Col-->
    </div>
    <div class="row mb-7">
         <label class="control-label fs-6 fw-bold mb-2">Thông tin khác</label>
         <textarea name="About" class="form-control mb-3 mb-lg-0" rows="4">${data.about || ""}</textarea>
    </div>
    <div class="mb-10 form-action">
        <div class="text-center pt-15">
            <button type="reset" class="btn btn-light me-3 remove-form" data-bs-dismiss="modal">Hủy</button>
            <button type="submit" class="btn btn-primary" id="submit-form-create-booking">Lưu</button>
        </div>
    </div>
    `;
};

//Booking - Edit
const editBookingDOM = (item, data, bookingId) => {
    let bookingType = [];
    for (let tmp in data.bookingTypes) {
        bookingType.push({ id: +tmp, name: data.bookingTypes[tmp] });
    }
    ;
    return `
    <input type="hidden" name="ID" value="${item.id}" />
    <input type="hidden" name="DateCreated" value="${item.dateCreated}" />
    <input type="hidden" name="IsDelete" value="${item.isDelete}" />
    <input type="hidden" name="CreatedBy" value="${item.createdBy}" />
    <div class="row mb-7">
        <div class="col-xl-6 form-group fv-row">
            <label class="control-label fs-6 fw-bold mb-2">Mã đơn hàng</label>
            <input name="Code" class="form-control form-control-solid mb-3 mb-lg-0"  autoComplete="off" value="${item.code}" placeholder="Mã đặt chỗ" readonly/>
        </div>
        <div class="col-xl-6 form-group fv-row">
            <label class="control-label fs-6 fw-bold mb-2">Khách hàng</label>
<!--             <a class="text-primary ms-auto mx-2" tooltip="Thêm mới" data-bs-stacked-modal="#modal-create-customer" onclick="CreateCustomerBooking();this.onclick = null;">-->
<!--               [+]-->
<!--            </a>-->
            <select name="CustomerID" class="form-select form-select-solid" data-control="booking-edit-select2">
                <option value="">Chọn khách hàng</option>
                ${buildOptions(data.customers, 'id', 'filterName', item.customerID)}
            </select>
        </div>
    </div>
    <div class="row mb-7">
        <div class="col-xl-6 fv-row">
             <label class="control-label fs-6 fw-bold mb-2">Loại đơn</label>
             <select name="BookingType" data-control="booking-edit-select2" class="form-select form-select-solid">
                 <option value="">Loại đơn</option>
                 ${buildOptions(bookingType, 'id', 'name', item.bookingType)}
             </select>
        </div>
        <div class="col-xl-6 fv-row">
            <label class="control-label fs-6 fw-bold mb-2">Điểm đến</label>
            <select name="DestinationID" data-control="booking-edit-select2" class="form-select form-select-solid">
                <option value="">Chọn điểm đến</option>
                ${buildOptions(data.destinations, 'id', 'name', item.destinationID)}
            </select>
        </div>
    </div>
    <div class="row mb-7 fv-row">
        <div class="col-xl-6">
             <label class="control-label fs-6 fw-bold mb-2">Ngày khởi hành</label>
             <input name="DepartureDay" class="form-control form-control-solid mb-3 mb-lg-0" data-date-time="flatpickr"  type="text" value="${formatDateTimeV2(item.departureDay)}"/>
        </div>
        <div class="col-xl-6 fv-row">
             <label class="control-label fs-6 fw-bold mb-2">Ngày về</label>
             <input name="EndDate" class="form-control form-control-solid mb-3 mb-lg-0" data-date-time="flatpickr" type="text" value="${formatDateTimeV2(item.endDate)}"/>
        </div>
    </div>
    <div class="row mb-7">
        <div class="col-xl-6">
             <label class="control-label fs-6 fw-bold mb-2">Chọn nguồn khách</label>
             <select name="SourceID" class="form-select form-select-solid" data-control="booking-edit-select2" data-items="create-booking-sourceId">
                 <option value="" >Chọn nguồn khách</option>
                 ${buildOptions(data.sources, 'id', 'name', item.sourceID)}
             </select>
        </div>
        <div class="col-xl-6">
             <label class="control-label fs-6 fw-bold mb-2">Liên kết nguồn</label>
             <input name="Link" class="form-control form-control-solid mb-3 mb-lg-0" data-items="create-booking-link-by-sourceId" autocomplete="off"/>
        </div>
    </div>
    <div class="row mb-7">
         <label class="control-label fs-6 fw-bold mb-2">Thông tin khác</label>
         <textarea name="About" class="form-control mb-3 mb-lg-0" rows="4" placeholder="Thông tin khác">${item.about}</textarea>
    </div>
    <div class="row mb-7 ${(item.status === 0 || item.status === 2) && "d-none"}" id="booking-note">
        <label class="control-label fs-6 fw-bold mb-2">Ghi chú</label>
        <textarea name="Note" class="form-control mb-3 mb-lg-0" rows="4">${item.note || ''}</textarea>
    </div>
    <div class="row mb-7">
        <label class="control-label fs-6 fw-bold mb-2">Trạng thái</label>
        <select name="Status" onchange="onBookingStatusChange(this)" class="form-select form-select-solid">
            <option ${item.status === 0 && "selected"} value="0">Đang xử lý</option>
            <option ${item.status === 1 && "selected"} value="1">Hủy</option>
            <option ${item.status === 2 && "selected"} value="2">Thành công</option>
            <option ${item.status === 3 && "selected"} value="3">Bảo lưu</option>
        </select>
    </div>
    `;
};

//Booking - AddTIcket
const bookingTicketDOM = (item, data, bookingId) => {
    let flightClasses = data.flightClasses.filter(e => e.airlineID === item.airlineID);
    return `
        <div class="row mb-5" id="ticket-code-${item.id}">
            <div class="col-lg-12 ">
                <div class="form-group d-flex gap-2">
                    <div class="w-150 w-md-150px fv-row">
                        <select name="TicketTypeID" class="form-select" data-items="ticketType" data-control="booking-addticket-select2" required>
                            <option value="">Loại vé</option>
                            ${buildOptions(data.ticketTypes, 'id', 'name', item.ticketTypeID)}
                        </select>
                    </div>
                    <div class="w-150 w-md-150px fv-row">
                        <input class="form-control" name="Code" autoComplete="off" value="${item?.code}"
                               placeholder="Mã đặt chỗ" required/>
                    </div>
                    <div class="w-200 w-md-200px fv-row">
                        <select name="AirlineID" data-items="airlines" class="form-select" data-control="booking-addticket-select2" required>
                            <option value="">Hãng bay</option>
                             ${buildOptions(data.airlines, 'id', 'name', item.airlineID)}
                        </select>
                    </div>
                    <div class="w-200 w-md-200px fv-row">
                        <select name="FlightID" class="form-select" data-items="flights" data-control="booking-addticket-select2" required>
                            <option value="">Chặng bay</option>
                             ${buildOptions(data.flights, 'id', 'name', item.flightID)}
                        </select>
                    </div>
                    <div class="w-200 w-md-200px fv-row">
                        <select name="FlightClassID" class="form-select" data-items="flight-class" data-control="booking-addticket-select2" required>
                            <option value="">Hãng vé</option>
                            ${buildOptions(flightClasses, 'id', 'name', item.flightClassID)}
                        </select>
                    </div>
                    <div class="w-150 w-md-150px fv-row">
                        <input name="FlightNumber" class="form-control" value="${item.flightNumber || ""}" autoComplete="off"
                               placeholder="Chuyến bay"/>
                    </div>
                    <div class="w-150 w-md-150px fv-row">
                        <input name="FlightDate" class="form-control" value="${item.flightDate || ""}" autoComplete="off"
                               placeholder="Ngày bay" data-date-time="flatpickr"/>
                    </div>
                    <div class="w-125 w-md-125px fv-row">
                        <input name="FlightTime" class="form-control input-time" value="${item.flightTime || ""}"
                               autoComplete="off" placeholder="Giờ bay"/>
                    </div>
                    <div class="w-150 w-md-150px fv-row">
                        <input name="PriceNetCode" class="form-control input-currency" value="0" autoComplete="off"
                               placeholder="Giá Net"/>
                    </div>
                    <div class="w-150 w-md-150px fv-row">
                        <input name="TotalPrice" class="form-control input-currency"
                               value="${formatCurrency(item.totalPrice)}" autoComplete="off"
                               placeholder="Tổng tiền"/>
                    </div>
                    <div class="w-150 w-md-150px fv-row">
                        <select name="PartnerID" class="form-select" data-items="partner" data-control="booking-addticket-select2" >
                            <option value="">Đối tác</option>
                            ${buildOptions(data.partners, 'id', 'name', item.partnerID)}
                        </select>
                    </div>
                    <div class="w-150 w-md-150px fv-row">
                        <select class="form-select">
                            <option>Tình trạng</option>
                        </select>
                    </div>
                    <div class="w-150 w-md-150px fv-row mt-2">
                        <div class="form-check form-switch form-check-custom form-check-solid">
                            <input name="IsRoudTrip" class="form-check-input" @Html.Raw(item.IsRoudTrip == true ?
                            "checked" : "") type="checkbox"/>
                            <label htmlFor="IsRoudTrip" class="form-check-label"></label> Khứu hồi
                        </div>
                    </div>
                    <div class="w-125 w-md-125px">
                        <input type="hidden" name="OrderID" value="${bookingId}">
<!--                        <input type="hidden" name="ticketCodeID" value="${item.id}">-->
                        <input type="hidden" name="CodeID" value="${item.id}">
                        <input type="hidden" name="RelatedID" value="${item.relatedID}">
                        <a class="btn btn-sm btn-icon btn-light-danger" data-id="${item.id}" id="btn-delete-ticketcode-${item.id}" onclick="DeleteTicketCode('${bookingId}', '${item.id}')"
                           data-action="data-delete-ticket-code" data-template="false"><i
                            class="fa fa-times"></i></a>
                        <a href="javascript:void(0);" class="btn btn-sm btn-icon btn-light-info btn-view" onclick="viewPersonTicket('${bookingId}','${item.id}')"
                           data-id="${item.id}" data-action="data-view-ticket-code" id="btn-view-person-ticket-${item.id}"><i
                            class="fa fa-eye"></i></a>
                    </div>
                </div>
           </div>
        </div>
    `;
};

const bookingTicketTemplate = (data, id, bookingId) => {
    return `
        <li class="row mb-5 new" id="ticket-code-${id}">
            <div class="col-lg-12">
                <div class="form-group d-flex gap-2">
                    <div class="w-150 w-md-150px fv-row">
                        <select name="TicketTypeID" class="form-select" data-items="ticketType" data-control="booking-addticket-select2" required>
                            <option value="">Loại vé</option>
                            ${buildOptions(data.ticketTypes, 'id', 'name')}
                        </select>
                    </div>
                    <div class="w-150 w-md-150px fv-row">
                        <input class="form-control" name="Code" autoComplete="off"
                               placeholder="Mã đặt chỗ" required/>
                    </div>
                    <div class="w-200 w-md-200px fv-row">
                        <select name="AirlineID" data-items="airlines" class="form-select" data-control="booking-addticket-select2" required>
                            <option value="">Hãng bay</option>
                             ${buildOptions(data.airlines, 'id', 'name')}
                        </select>
                    </div>
                    <div class="w-200 w-md-200px fv-row">
                        <select name="FlightID" class="form-select" data-items="flights" data-control="booking-addticket-select2" required>
                            <option value="">Chặng bay</option>
                             ${buildOptions(data.flights, 'id', 'name')}
                        </select>
                    </div>
                    <div class="w-200 w-md-200px fv-row">
                        <select name="FlightClassID" class="form-select" data-items="flight-class" data-control="booking-addticket-select2" required>
                            <option value="">Hãng vé</option>
                        </select>
                    </div>
                    <div class="w-150 w-md-150px fv-row">
                        <input name="FlightNumber" class="form-control"  autoComplete="off"
                               placeholder="Chuyến bay"/>
                    </div>
                    <div class="w-150 w-md-150px fv-row">
                        <input name="FlightDate" class="form-control"  autoComplete="off"
                               placeholder="Ngày bay" data-date-time="flatpickr"/>
                    </div>
                    <div class="w-125 w-md-125px">
                        <input name="FlightTime" class="form-control input-time"
                               autoComplete="off" placeholder="Giờ bay"/>
                    </div>
                    <div class="w-150 w-md-150px fv-row">
                        <input name="PriceNetCode" class="form-control input-currency" value="0" autoComplete="off"
                               placeholder="Giá Net"/>
                    </div>
                    <div class="w-150 w-md-150px fv-row">
                        <input name="TotalPrice" class="form-control input-currency" value="0"
                                autoComplete="off"
                               placeholder="Tổng tiền"/>
                    </div>
                    <div class="w-150 w-md-150px fv-row">
                        <select name="PartnerID" class="form-select" data-items="partner" data-control="booking-addticket-select2">
                            <option value="">Đối tác</option>
                            ${buildOptions(data.partners, 'id', 'name')}
                        </select>
                    </div>
                    <div class="w-150 w-md-150px fv-row">
                        <select class="form-select">
                            <option>Tình trạng</option>
                        </select>
                    </div>
                    <div class="w-150 w-md-150px fv-row mt-2">
                         <div class="form-check form-switch form-check-custom form-check-solid">
                             <input name="IsRoudTrip" class="form-check-input" value="false" type="checkbox" />
                             <label for="IsRoudTrip" class="form-check-label"></label> Khứu hồi
                         </div>
                     </div>
                    <div class="w-125 w-md-125px">
                         <input type="hidden" name="OrderID" value="${bookingId}">
                         <input type="hidden" name="CodeID" value="${id}">
                         <input type="hidden" name="RelatedID" value="00000000-0000-0000-0000-000000000000">
                         <a href="javascript:void(0);" class="btn btn-sm btn-icon btn-light-danger" data-id="${id}" id="btn-delete-ticketcode-${id}" onclick="DeleteTicketCode('${bookingId}', '${id}')" data-action="data-delete-ticket-code" data-template="true"><i class="fa fa-times"></i></a>
                         <a href="javascript:void(0);" class="btn btn-sm btn-icon btn-light-info btn-view" data-id="${id}" data-action="data-view-ticket-code" id="btn-view-person-ticket-${id}" onclick="viewPersonTicket('${bookingId}','${id}')"><i class="fa fa-eye"></i></a>
                     </div>
                </div>
           </div>
        </div>
    `
}

const bookingTicketPersonDOM = (id, data, bookingId) => {
    return `
        <div class="d-none row" id="person-pane-${id}" data-id="${id}">
            <div class="nav flex-column col-lg-2 mb-10 mb-lg-0" id="nav-booking-${id}">
            </div>
            <div class="col-lg-10">
                <div class="tab-content rounded h-100 bg-light p-3" id="ticket-persons-${id}">
                </div>
            </div>
        </div>
    `
}

const navPersonTicket = (item, bookingId, id) => {
    let count = item.bookingPersons.filter(b => b.bookingID === bookingId).length;

    return `
        <!--begin::Tab link-->
        <div class="nav-link btn btn-outline btn-outline-dashed btn-color-dark btn-active btn-active-primary d-flex flex-stack text-start p-4 mb-4 " data-bs-toggle="tab" data-bs-target="#panel-age-${id}-${item.id}">
            <div class="d-flex align-items-center me-2">
                <div class="flex-grow-1">
                    <div class="d-flex align-items-center fs-4 fw-bolder flex-wrap pt-2">${item.name}</div>
                </div>
            </div>
            <div class="ms-5">
                <span class="fs-3x fw-bolder age-item">${count}</span>
            </div>
        </div>
        <!--end::Tab link-->
    `
}

const panePersonTicket = (item, data, bookingId, id, newGuid) => {
    let listPerson = item.bookingPersons.filter(b => b.bookingID === bookingId);

    const emptyPerson = `
        <div class="tab-pane fade" id="panel-age-${id}-${item.id}">
            <div class="flex-grow-1">
                <div class="table-responsive">
                    <table class="table table-row-dashed table-row-gray-300">
                        <thead>
                            <tr class="fw-bolder fs-6 text-gray-800 text-uppercase">
                                <th class="min-w-200px">Hành khách</th>
                                <th class="min-w-100px">Xách tay</th>
                                <th class="min-w-80px">Ký gửi</th>
                                <th class="min-w-80px">Mua (kg)</th>
                                <th class="min-w-125px">Giá hành lý</th>
                                <th class="min-w-125px">Giá Net</th>
                                <th class="min-w-125px">Giá vé</th>
                                <th class="min-w-80px">Số ghế</th>
                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    `;

    const havePerson = `
        <div class="tab-pane fade" id="panel-age-${id}-${item.id}">
            <div class="flex-grow-1">
                <div class="table-responsive">
                    <table class="table table-row-dashed table-row-gray-300">
                        <thead>
                            <tr class="fw-bolder fs-6 text-gray-800 text-uppercase">
                                <th class="min-w-200px">Hành khách</th>
                                <th class="min-w-100px">Xách tay</th>
                                <th class="min-w-80px">Ký gửi</th>
                                <th class="min-w-80px">Mua (kg)</th>
                                <th class="min-w-125px">Giá hành lý</th>
                                <th class="min-w-125px">Giá Net</th>
                                <th class="min-w-125px">Giá vé</th>
                                <th class="min-w-80px">Số ghế</th>
                            </tr>
                        </thead>
                        <tbody>
                        ${listPerson.map(person => {
        if (person.bookingTickets?.[0]?.ticketCodeID === id) {
            return /* html */ `
                                    <tr>
                                        <td>
                                            <input type="hidden" name="BookingID" value="${bookingId}">
                                            <input type="hidden" name="TicketCodeID" value="${id}">
                                            <select name="PersonID" class="form-select">
                                                <option value="">Chọn hành khách</option>
                                                ${buildOptions(listPerson, 'id', 'filterName', person.bookingTickets[0].personID)}
                                            </select>
                                        </td>
                                        <td><input name="CarryOnLuggage" class="form-control mb-3 mb-lg-0" autocomplete="off" type="number" value="${person.bookingTickets[0].carryOnLuggage}" min="0" max="200" /></td>
                                        <td><input name="CheckInBaggage" class="form-control mb-3 mb-lg-0" autocomplete="off" type="number" value="${person.bookingTickets[0].checkInBaggage}" min="0" max="200" /></td>
                                        <td><input name="OverweightBaggage" class="form-control mb-3 mb-lg-0" autocomplete="off" type="number" value="${person.bookingTickets[0].overweightBaggage}" min="0" /></td>
                                        <td><input name="PriceBaggage" class="form-control mb-3 mb-lg-0" autocomplete="off" type="number" value="${person.bookingTickets[0].priceBaggage}" /></td>
                                        <td><input name="PriceNet" class="form-control mb-3 mb-lg-0" autocomplete="off" type="number" value="${person.bookingTickets[0].priceNet}" /></td>
                                        <td><input name="Price" class="form-control mb-3 mb-lg-0" autocomplete="off" type="number" value="${person.bookingTickets[0].price}" /></td>
                                        <td><input name="Seat" class="form-control mb-3 mb-lg-0" autocomplete="off" value="${person.bookingTickets[0].seat}" /><input type="hidden" name="BookingTicketID" value="${person.bookingTickets[0].id}"></td>
                                    </tr>
                                `;
        } else {
            return /* html */ `
                                    <tr>
                                        <td>
                                            <input type="hidden" name="BookingID" value="${bookingId}">
                                            <input type="hidden" name="TicketCodeID" value="${id}">
                                            <select name="PersonID" class="form-select">
                                                <option value="00000000-0000-0000-0000-000000000000">Chọn hành khách</option>
                                                ${buildOptions(listPerson, 'id', 'filterName')}
                                            </select>
                                        </td>
                                        <td><input name="CarryOnLuggage" class="form-control mb-3 mb-lg-0" autocomplete="off" type="number" value="0" min="0" max="200" /></td>
                                        <td><input name="CheckInBaggage" class="form-control mb-3 mb-lg-0" autocomplete="off" type="number" value="0" min="0" max="200" /></td>
                                        <td><input name="OverweightBaggage" class="form-control mb-3 mb-lg-0" autocomplete="off" type="number" value="0" min="0" /></td>
                                        <td><input name="PriceBaggage" class="form-control mb-3 mb-lg-0" autocomplete="off" type="number" value="0" /></td>
                                        <td><input name="PriceNet" class="form-control mb-3 mb-lg-0" autocomplete="off" type="number" value="0" /></td>
                                        <td><input name="Price" class="form-control mb-3 mb-lg-0" autocomplete="off" type="number" value="0" /></td>
                                        <td><input name="Seat" class="form-control mb-3 mb-lg-0" autocomplete="off" value="0" /><input type="hidden" name="BookingTicketID" value="${newGuid}"></td>
                                    </tr>
                                `;
        }
    }).join("")}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    `;

    return listPerson.length > 0 ? havePerson : emptyPerson;
}

//Bookings - AddPerson
const navAddPerson = (item, bookingId, index) => {
    return `
        <!--begin::Tab link-->
            <div class="nav-link btn btn-outline btn-outline-dashed btn-color-dark btn-active btn-active-primary d-flex flex-stack text-start p-4 mb-4 ${index === 0 ? "active" : ""} " data-bs-toggle="tab" data-bs-target="#panel-add-age-${bookingId}-${item.id}" >
                <div class="d-flex align-items-center me-2">
                    <div class="flex-grow-1">
                        <div class="d-flex align-items-center fs-4 fw-bolder flex-wrap pt-2">${item.name}</div>
                    </div>
                </div>
                <div class="ms-5 input-group nav-add-person-input-group">
                    <input type="number" class="form-control" id="quantity-add-person-${item.id}" data-age="quantity" data-id="${item.id}" min="0" value="${item.bookingPersons.length}" max="200" readonly>
                    <a class="btn btn-light-primary btn-active-primary" id="btn-add-person-${item.id}" onclick="AddNewPerson('${bookingId}','${item.id}')">[+]</a>
                </div>
            </div>
        <!--end::Tab link-->
    `;
}

const paneAddPerson = (item, data, bookingId, index) => {
    const genders = [];
    for (let i = 0; i < data.genders.length; i++) {
        genders.push({ id: +data.genders[i].value, text: data.genders[i].text })
    }
    const tmp = `
        <div class="tab-pane fade ${index === 0 ? "show active" : ""}" id="panel-add-age-${bookingId}-${item.id}">
            <div class="flex-grow-1">
                <div class="table-responsive">
                    <table class="table table-row-dashed table-row-gray-300">
                        <thead>
                            <tr class="fw-bolder fs-6 text-gray-800 text-uppercase">
                                <th class="min-w-80px pb-2">Giới tính</th>
                                <th class="min-w-200px pb-2">Họ và tên đệm</th>
                                <th class="min-w-200px pb-2">Tên khách</th>
                                <th class="min-w-125px pb-2">Ngày sinh</th>
                                <th class="min-w-125px pb-2">CMND/CCCD</th>
                                <th class="text-end pb-2">
                                    <a href="javascript:void(0);" class="btn btn-sm btn-icon btn-light-danger" hidden="hidden" data-action="data-bookings-delete-person" data-template="false"><i class="fa fa-times"></i></a>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                        ${item.bookingPersons ?
                        item.bookingPersons.map(e => {
                             return `<tr id="person-info-${e.id}">
                                        <td>
                                            <select name="Gender" class="form-select" required>
                                                <option value="">Giới tính</option>
                                                ${buildOptions(genders, 'id', 'text', e.gender)}
                                            </select>
                                        </td>
                                        <td>
                                            <input name="FirstMidName" class="form-control mb-3 mb-lg-0 text-uppercase" autocomplete="off"  value="${e.firstMidName}" placeholder="Họ và tên đệm"/>
                                        </td>
                                        <td>
                                            <input name="LastName" class="form-control mb-3 mb-lg-0 text-uppercase" autocomplete="off" value="${e.lastName}" placeholder="Tên khách"/>
                                        </td>
                                        <td>
                                            <input name="Birthday" class="form-control mb-3 mb-lg-0" autocomplete="off" value="${e.birthday || ""}" placeholder="Ngày sinh"/>
                                        </td>
                                        <td>
                                            <input name="CMND" class="form-control mb-3 mb-lg-0" autocomplete="off" value="${e.cmnd || ""}" placeholder="CMND/CCCD"/>
                                        </td>
                                        <td class="text-end">
                                            <input type="hidden" name="BookingID" value="${e.bookingID}">
                                            <input type="hidden" name="AgeID" value="${e.ageID}">
                                            <input type="hidden" name="BookingPersonID" value="${e.id}">
                                            <a href="javascript:void(0);" class="btn btn-sm btn-icon btn-light-danger" id="btn-delete-person-${e.id}" data-action="data-bookings-delete-person" data-template="false" onclick="DeletePerson('${e.bookingID}','${e.ageID}','${e.id}')"><i class="fa fa-times"></i></a>
                                        </td>
                                    </tr>`
            }).join("")
            : ""
        }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    `;

    return tmp;
}

const addNewPersonDOM = (itemId, data, bookingId, newId) => {
    const genders = [];
    for (let i = 0; i < data.genders.length; i++) {
        genders.push({ id: +data.genders[i].value, text: data.genders[i].text })
    }
    let typeRandom = "uppercase";
    return `
        <tr id="person-info-${newId}" class="new">
            <td>
                <select name="Gender" class="form-select" required>
                    <option value="">Giới tính</option>
                    ${buildOptions(genders, 'id', 'text', RandomGender(1,3))}
                </select>
            </td>
            <td>
                <input name="FirstMidName" class="form-control mb-3 mb-lg-0 text-uppercase" autocomplete="off" placeholder="Họ và tên đệm" value="${RandomString(1,typeRandom)}"/>
            </td>
            <td>
                <input name="LastName" class="form-control mb-3 mb-lg-0 text-uppercase" autocomplete="off" placeholder="Tên khách" value="${RandomString(1,typeRandom)}"/>
            </td>
            <td>
                <input name="Birthday" class="form-control mb-3 mb-lg-0" autocomplete="off" placeholder="Ngày sinh"/>
            </td>
            <td>
                <input name="CMND" class="form-control mb-3 mb-lg-0" autocomplete="off" placeholder="CMND/CCCD"/>
            </td>
            <td class="text-end">
                <input type="hidden" name="BookingID" value="${bookingId}">
                <input type="hidden" name="AgeID" value="${itemId}">
                <input type="hidden" name="BookingPersonID" value="${newId}">
                <a href="javascript:void(0);" class="btn btn-sm btn-icon btn-light-danger" id="btn-delete-person-${newId}" data-action="data-bookings-delete-person" data-template="true" onclick="DeletePerson('${bookingId}','${itemId}','${newId}')"><i class="fa fa-times"></i></a>
            </td>
        </tr>
    `
};


// Bookings - CustomerInfo
// const bookingType = (type) => {
//     let typeName = "";
//     switch (type) {
//         case 1:
//             typeName = '<span class="badge badge-light-warning fs-7">Combo</span>';
//             break;
//         case 2:
//             typeName = '<span class="badge badge-light-primary fs-7">Voucher</span>';
//             break;
//         case 3:
//             typeName = '<span class="badge badge-light-info fs-7">Dịch vụ</span>';
//             break;
//         case 4:
//             typeName = '<span class="badge badge-light-info fs-7">Land tour</span>';
//             break;
//     }
//     ;
//     return typeName;
// };
const bookingType = {
    '1': '<span class="badge badge-light-warning fs-7">Combo</span>',
    '2': '<span class="badge badge-light-primary fs-7">Voucher</span>',
    '3': '<span class="badge badge-light-info fs-7">Vé máy bay</span>',
    '4': '<span class="badge badge-light-info fs-7">Dịch vụ</span>',
    '5': '<span class="badge badge-light-info fs-7">Land tour</span>',
}

const status = {
    '0': '<span class="badge badge-light-info d-inline">Đang xử lý</span>',
    '1': '<span class="badge badge-light-success d-inline">Thành công</span>',
    '2': '<span class="badge badge-light-danger d-inline">Hủy</span>',
}

const bookingOfCustomerTemplate = (item) => {
    return `
        <tr>
            <td>${item.code}</td>
            <td>${formatDateTime(item.dateCreated)}</td>
            <td>
                ${bookingType[item.bookingType]}
            </td>
            <td>
                ${status[item.status]}
            </td>
        </tr>
    `;
};

const createCustomerBookingDOM = (data) => {
    let vocatives = [];
    for (let tmp in data.vocatives) {
        vocatives.push({ id: tmp, name: tmp })
    }
    let genders = []
    for (let tmp in data.genders) {
        genders.push({ id: +tmp, name: data.genders[tmp] })
    }
    return `
        <div class="row mb-7">
            <input name="Status" type="hidden" value="true" />

            <div class="col-xl-4 form-group fv-row">
                <label class="control-label fs-6 fw-bold mb-2">Mã khách hàng</label>
                <input name="Code" class="form-control form-control-solid mb-3 mb-lg-0"  autoComplete="off" value="${data.code}" placeholder="Mã đặt chỗ" readonly/>
            </div>
            <div class="col-xl-4 form-group fv-row">
                <label class="control-label fs-6 fw-bold mb-2">Danh xưng</label>
                <select name="Vocative" class="form-select form-select-solid" data-control="select2">
                    ${buildOptions(vocatives, 'id', 'name', 'Anh')}
                </select>
            </div>
             <div class="col-xl-4 form-group fv-row">
                <label class="control-label fs-6 fw-bold mb-2">Giới tính</label>
                <select name="Gender" class="form-select form-select-solid" data-control="select2">
                    ${buildOptions(genders, 'id', 'name', 1)}
                </select>
            </div>
        </div>
        <div class="row mb-7">
            <div class="col-xl-4 form-group fv-row">
                 <label class="control-label fs-6 fw-bold mb-2">Họ và tên đệm</label>
                 <input name="FirstMidName" class="form-control form-control-solid mb-3 mb-lg-0"/>
            </div>
            <div class="col-xl-4 form-group fv-row">
                <label class="control-label fs-6 fw-bold mb-2">Tên</label>
                <input name="LastName" class="form-control form-control-solid mb-3 mb-lg-0"/>
            </div>
             <div class="col-xl-4 form-group fv-row">
                <label class="control-label fs-6 fw-bold mb-2">Ngày sinh</label>
                <input name="Birthday" class="form-control form-control-solid mb-3 mb-lg-0" data-date-time="flatpickr" />
            </div>
        </div>
        <div class="row mb-7">
            <div class="col-xl-4 form-group fv-row">
                 <label class="control-label fs-6 fw-bold mb-2">Số điện thoại</label>
                 <input type="tel" name="Phone" class="form-control form-control-solid mb-3 mb-lg-0 input-phone"/>
            </div>
            <div class="col-xl-4 form-group fv-row">
                <label class="control-label fs-6 fw-bold mb-2">Địa chỉ</label>
                <input name="Address" class="form-control form-control-solid mb-3 mb-lg-0" autocomplete="off" />
            </div>
            <div class="col-xl-4 form-group fv-row">
                <label class="control-label fs-6 fw-bold mb-2">Email</label>
                <input name="Email" class="form-control form-control-solid mb-3 mb-lg-0" autocomplete="off" />
            </div>
        </div>
        <div class="row mb-7">
            <div class="col-xl-4 form-group fv-row">
                <label class="control-label fs-6 fw-bold mb-2">Tỉnh/Thành phố</label>
                <select name="ProvinceID" class="form-select form-select-solid" data-control="select2">
                    ${buildOptions(data.provinces, 'id', 'name')}
                </select>
            </div>
            <div class="col-xl-4 form-group fv-row">
                <label class="control-label fs-6 fw-bold mb-2">Loại khách hàng</label>
                <select name="CustomerTypeID" class="form-select form-select-solid" data-control="select2">
                    ${buildOptions(data.customerTypes, 'id', 'name')}
                </select>
            </div>
        </div>
        <div class="row mb-7">
             <div class="col-xl-12 form-group">
                <label class="control-label fs-6 fw-bold mb-2">Ghi chú</label>
                <textarea name="About" class="form-control form-control-solid mb-3 mb-lg-0" rows="5"></textarea>
            </div>
        </div>
        <div class="row">
            <div class="text-center pt-15">
                <input type="reset" class="btn btn-light me-3 remove-form" data-bs-dismiss="modal" value="Hủy"></input>
                <input type="submit" class="btn btn-primary" id="submit-form-create-customer-booking" value="Lưu"></input>
            </div>
        </div>
    `
}
const AddHotelActionDOM = (data, bookingId, newGuid) => {
    return `
        <div class="w-200 w-md-200px">
            <select name="Destinations" data-control="booking-hotel-select2" data-items="destination" class="form-select form-select-solid">
                <option value="">Chọn điểm đến</option>
                ${buildOptions(data.destinations, "id", "name", "04364340-2569-4608-9cbb-eed220942ea4")}
            </select>
        </div>
        <div class="w-200 w-md-300px">
            <select name="Hotels"  data-control="booking-hotel-select2" class="form-select form-select-solid" data-items="hotel">
                <option value="">Chọn khách sạn</option>
            </select>
        </div>
        <div class="w-200 w-md-300px">
            <select class="form-select form-select-solid" data-control="booking-hotel-select2" name="RoomTypes" data-items="room-type" >
                <option value="">Chọn loại phòng</option>
            </select>
        </div>
        <div class="w-200 w-md-300px">
           <select class="form-select form-select-solid" data-control="booking-hotel-select2" name="Partners" data-items="partners" >
                <option value="">Chọn đối tác</option>
                ${buildOptions(data.partners, "id", "name")}
            </select>
         </div>
        <button type="button" data-action="add-room" class="btn btn-sm btn-light-primary" onclick="AddNewHotel('${bookingId}')" disabled>
            <span class="svg-icon svg-icon-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <rect opacity="0.5" x="11" y="18" width="12" height="2" rx="1" transform="rotate(-90 11 18)" fill="currentColor"></rect>
                    <rect x="6" y="11" width="12" height="2" rx="1" fill="currentColor"></rect>
                </svg>
            </span> Thêm loại phòng
        </button>
    `;
}

const AddHotelInfoDOM = (item) => {
    const idForSurcharge = "surcharge_"+item.id;
    return `
        <tr id="booking-hotel-${item.id}">
            <td>
                <a onclick="displaySurcharge('${idForSurcharge}')" class="btn text-danger fw-boldest fs-5 ps-5 p-0 collapsed" href="#">
                    <i class="fa fa-chevron-down"></i>
                </a>
            </td>
            <td>
                <input type="hidden" name="HotelID" value="${item.hotelID}">
                <input type="hidden" name="RoomTypeID" value="${item.roomTypeID}">
                <div class="text-gray-800 text-hover-primary fs-5 fw-bolder">
                    ${item.hotel.name}
                </div>
                <div class="text-gray-600 mt-3">- ${item.partner ? `${item.partner.name}` : 'N/A'}</div>
                <div class="text-gray-600 mt-3">- Phòng ${item.roomType.name}</div>
            </td>
            <td>
                <input type="hidden" name="BookingID" value="${item.bookingID}">
                <input type="hidden" name="PartnerID" value="${item?.partnerID || '00000000-0000-0000-0000-000000000000'}">
                <input type="hidden" name="BookingHotelID" value="${item.id}">
                <input type="text" name="BookingCode" class="form-control" value="${item.bookingCode || ""}">
            </td>
            <td>
                <input class="form-control" data-date-time="flatpickr" onChange="onBookingHotelDateChange(event)" readonly="readonly" value="${formatDateTimeV2(item.checkIn)}" name="CheckIn">
            </td>
            <td>
                <input class="form-control" data-date-time="flatpickr" onChange="onBookingHotelDateChange(event)" readonly="readonly" value="${formatDateTimeV2(item.checkOut)}" name="CheckOut">
            </td>
            <td>
                 <input type="number" name="QuantityDay" class="form-control booking-hotel-countDay" min="0" value="${item.quantityDay || 0}">
            </td>
            <td>
                <input type="number" name="Adult" class="form-control" min="1" value="${item.adult || 1}">
            </td>
            <td>
                <input type="number" name="Child" class="form-control" min="0" value="${item.child || 0}">
            </td>
             <td>
                <input type="number" name="Quantity" class="form-control" min="1" value="${item.quantity || 1}">
            </td>
            <td>
                <input name="Price" class="form-control input-currency" min="0" value="${formatCurrency(item.price || 0)}">
            </td>
            <td>
                <a href="javascript:void(0);" data-id="${item.id}" class="btn btn-sm btn-icon btn-light-danger" data-action="data-bookings-delete-hotel" data-template="false" onclick="DeleteAddHotel('${item.bookingID}','${item.id}','false')"><i class="fa fa-times"></i></a>
            </td>
        </tr>
        <tr id="${idForSurcharge}" class="d-none">
            <td colspan="12">
                <div class="border-between surcharge">
                    <div class="form fv-plugins-bootstrap5 fv-plugins-framework">
                        <div class="row mb-7">
                            <div class="col-xl-2">
                                <label class="control-label fs-6 fw-bold mb-2">Đối tác phụ thu</label>
                                <input name="Surcharge" class="form-control input-currency mb-5" min="0" value="${formatCurrency(item.surcharge || 0)}">
                                <label class="control-label fs-6 fw-bold mb-2">Số lượng phụ thu</label>
                                <input type="number" name="QuantitySurcharge" class="form-control mb-3 mb-lg-0" min="0" value="${item.quantitySurcharge || 0}">
                            </div>
                            <div class="col-xl-10">
                                <label class="control-label fs-6 fw-bold mb-2">Lý do phụ thu</label>
                                <textarea type="text" name="AboutSurcharge" class="form-control mb-3 mb-lg-0" rows="5" value="">${item.aboutSurcharge || ""}</textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </td>
        </tr>
    `
};

const AddHotelInfoNewDOM = (newBookingHotelId, bookingId, obj) => {
    let checkIn = new Date();
    let checkOut = new Date(Date.now() + (60 * 60 * 24 * 1000));
    console.log('checkin', checkIn);
    console.log('checkout', checkOut);
    const idForSurcharge = "surcharge_"+newBookingHotelId;
    return `
         <tr id="booking-hotel-${newBookingHotelId}">
            <td>
                <a onclick="displaySurcharge('${idForSurcharge}')" class="btn text-danger fw-boldest fs-5 ps-5 p-0 collapsed" href="#">
                    <i class="fa fa-chevron-down"></i>
                </a>
            </td>
            <td>
                <input type="hidden" name="HotelID" value="${obj.hotel.id}">
                <input type="hidden" name="RoomTypeID" value="${obj.roomType.id}">
                <div class="text-gray-800 text-hover-primary fs-5 fw-bolder">
                    ${obj.hotel.name}
                </div>
                <div class="text-gray-600 mt-3">- ${obj.partner ? `${obj.partner.name}` : 'N/A'}</div>
                <div class="text-gray-600 mt-3">- Phòng ${obj.roomType.name}</div>
            </td>
            <td>
                <input type="hidden" name="BookingID" value="${bookingId}">
                <input type="hidden" name="PartnerID" value="${obj.partner.id || '00000000-0000-0000-0000-000000000000'}">
                <input type="hidden" name="BookingHotelID" value="${newBookingHotelId}">
                <input type="text" name="BookingCode" class="form-control" value="">
            </td>
            <td>
                <input class="form-control" data-date-time="flatpickr" onChange="onBookingHotelDateChange(event)" readonly="readonly" value="${formatDateTimeV2(checkIn)}" name="CheckIn">
            </td>
            <td>
                <input class="form-control" data-date-time="flatpickr" onChange="onBookingHotelDateChange(event)" readonly="readonly" value="${formatDateTimeV2(checkOut)}" name="CheckOut">
            </td>
            <td>
                <input type="number" name="QuantityDay" class="form-control" min="0" value="${countBetweenDay(checkIn, checkOut)}">
            </td>
            <td>
                <input type="number" name="Adult" class="form-control" min="1" value="1">
            </td>
            <td>
                <input type="number" name="Child" class="form-control" min="0" value="0">
            </td>
            <td>
                <input type="number" name="Quantity" class="form-control" min="1" value="1">
            </td>
            <td>
                <input name="Price" class="form-control input-currency" min="0" value="0">
            </td>
            <td>
                <a href="javascript:void(0);" data-id="${newBookingHotelId}" class="btn btn-sm btn-icon btn-light-danger" data-action="data-bookings-delete-hotel" data-template="true" onclick="DeleteAddHotel('${bookingId}','${newBookingHotelId}','true')"><i class="fa fa-times"></i></a>
            </td>
        </tr>
        <tr id="${idForSurcharge}" class="d-none">
            <td colspan="12">
                <div class="border-between surcharge">
                    <div class="form fv-plugins-bootstrap5 fv-plugins-framework">
                        <div class="row mb-7">
                            <div class="col-xl-2">
                                <label class="control-label fs-6 fw-bold mb-2">Đối tác phụ thu</label>
                                <input name="Surcharge" class="form-control input-currency mb-5" min="0" value="0">
                                <label class="control-label fs-6 fw-bold mb-2">Số lượng phụ thu</label>
                                <input type="number" name="QuantitySurcharge" class="form-control input-currency mb-3 mb-lg-0" min="0" value="0">
                            </div>
                            <div class="col-xl-10">
                                <label class="control-label fs-6 fw-bold mb-2">Lý do phụ thu</label>
                                <textarea type="text" name="AboutSurcharge" class="form-control mb-3 mb-lg-0" rows="5" value=""></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </td>
        </tr>
    `
}

const ShowQuoteDOM = (bookingid, data) => {
    let totalPayment = 0;
    return `
        <div class="flex-lg-row-fluid me-xl-18 mb-10 mb-xl-0">
            <div class="mt-n1">
                <div class="m-0">
                    <div class="fw-bolder fs-3 text-gray-800 mb-8">Mã đơn hàng #${data.booking.code}</div>
                    <div class="row g-5 mb-11" id="quote-time-${bookingid}">
                        <div class="col-6 col-sm-6">
                            <div class="fw-bold fs-7 text-gray-600 mb-1">Ngày tạo:</div>
                            <div class="fw-bolder fs-6 text-gray-800">${formatDateTime(Date.now())}</div>
                        </div>
                        <div class="col-6 col-sm-6">
                            <div class="fw-bold fs-7 text-gray-600 mb-1">Chuyến đi dự kiến:</div>
                            <div class="fw-bolder fs-6 text-gray-800 d-flex align-items-center flex-wrap">
                                <span class="pe-2">${formatDateTime(data.booking.departureDay)} - </span>
                                <span class="fs-7 text-danger d-flex align-items-center">
                                    ${formatDateTime(data.booking.endDate)}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="row g-5 mb-12">
                        <div class="col-6 col-sm-6">
                            <div class="fw-bold fs-7 text-gray-600 mb-1">Gửi bởi:</div>
                                <!-- <div class="fw-bolder fs-6 text-gray-800">@user?.FullName</div> -->
                                <!-- <div class="fw-bold fs-7 text-gray-600">-->
                                <!--    @Model.Business?.Name.-->
                                <!--    <br> @Model.Business?.Address-->
                                <!--    <br> @Model.Business?.Phone-->
                                <!-- </div>-->
                            <div class="fw-bolder fs-6 text-gray-800">Nguyễn Trà Giang</div>
                        </div>
                        <div class="col-6 col-sm-6">
                            <div class="fw-bold fs-7 text-gray-600 mb-1">Gửi tới:</div>
                            <div class="fw-bolder fs-6 text-gray-800">${data.booking.customer.fullName}</div>
                            <div class="fw-bold fs-7 text-gray-600">
                                <!-- ${data.booking.customer.code} <br>-->
                                ${data.booking.customer.phone || ""}
                            </div>
                        </div>
                    </div>
                    <div class="flex-grow-1">
                        <div class="table-responsive">
                            <table class="table table-striped quote-table">
                                <thead>
                                    <tr class="border-bottom fs-6 fw-bolder text-muted text-uppercase">
                                        <th class="min-w-175px pb-2">Độ tuổi</th>
                                        <th class="min-w-70px text-align-left pb-2">Số lượng</th>
                                        <th class="min-w-80px text-end pb-2">Giá bán</th>
                                        <th class="min-w-100px text-end pb-2">Tổng tiền</th>
                                    </tr>
                                </thead>
                                <tbody>
                                ${data.ages.map(e => {
                                    if (e.bookingAge) {
                                        let totalQuantitybyAge = e.bookingAge.quantity;
                                        let pricePersonbyAge = e.bookingAge.price;
                                        var totalAmount = totalQuantitybyAge * pricePersonbyAge;
                                        totalPayment += totalAmount;
                                        return `
                                             <tr class="fw-bolder text-gray-700 fs-5 text-end">
                                                <td class="d-flex align-items-center">
                                                    <i class="fa fa-genderless text-primary fs-2 me-2"></i> ${e.name}
                                                </td>
                                                <td class="text-center">${totalQuantitybyAge}</td>
                                                <td>${formatCurrency(pricePersonbyAge)} VNĐ</td>
                                                <td class="fs-5 text-dark fw-boldest">${formatCurrency(totalAmount)} VNĐ</td>
                                            </tr>
                                        `
                                    }
                                }).join("")
                                    }
                                </tbody>
                            </table>
                        </div>
                        <div class="d-flex justify-content-end mb-9">
                            <div class="mw-400px">
                                <div class="d-flex flex-stack mb-3">
                                    <div class="fw-bold pe-10 text-gray-600 fs-2">Tổng thanh toán:</div>
                                    <div class="text-end fw-bolder fs-2 text-danger" id="total-payment-${bookingid}">${formatCurrency(totalPayment)} VNĐ</div>
                                </div>
                            </div>
                        </div>

                        ${data.booking.ticketCodes.length > 0 ?
            `
                                    <h3 class="text-uppercase mt-5">Vé máy bay</h3>
                                    <table class="table table-striped border table-row-bordered gy-5">
                                    <tbody>
                                        <tr class="text-start text-gray-800 fw-boldest fs-7 text-uppercase">
                                            <th class="px-2 min-w-200px">Mã đặt chỗ</th>
                                            <th class="min-w-100px">Hãng bay</th>
                                            <th class="min-w-100px">Chặng bay</th>
                                            <th class="min-w-100px">Hạng ghế</th>
                                            <th class="px-2 min-w-100px">Ngày giờ bay</th>
                                        </tr>
                                            ${data.booking.ticketCodes.map(t => {
                return `
                                                        <tr class="">
                                                            <td class="px-2 e-0 text-danger"><strong>${t.code}</strong></td>
                                                            <td class="pe-0">${t.airline.name || ""}</td>
                                                            <td class="pe-0">${t.flight.name || ""}</td>
                                                            <td class="pe-0">${t.flightClass.name || ""}</td>
                                                            <td class="px-2 pe-0">${t.flightDate ? t.flightDate + " | " : ""}  ${t.flightTime || ""}</td>
                                                        </tr>
                                                    `
                                            }).join("")
                                            }
                                        </tbody>
                                    </table>
                                `
            : ""
        }
                        ${data.booking.bookingHotels.length > 0 ?
            `
                                <h3 class="text-uppercase mt-5">Phòng khách sạn</h3>
                                <table class="table table-striped border table-row-bordered gy-5">
                                    <tbody>
                                        <tr class="text-start text-gray-800 fw-boldest fs-7 text-uppercase">
                                            <th class="px-2 min-w-100px">Mã booking</th>
                                            <th class="min-w-200px">Khách sạn</th>
                                            <th class="min-w-100px">Loại phòng</th>
                                            <th class="min-w-100px text-center">Số lượng</th>
                                            <th class="min-w-100px text-center">Nhận phòng</th>
                                            <th class="px-2 min-w-100px text-center">Trả phòng</th>
                                        </tr>
                                            ${data.booking.bookingHotels.map(t => {
                return `
                                                        <tr>
                                                            <td class="px-2 min-w-100px text-danger">${t.bookingCode || ""}</td>
                                                            <td class="min-w-200px">${t.hotel.name || ""}</td>
                                                            <td class="min-w-100px">${t.roomType.name || ""}</td>
                                                            <td class="min-w-100px text-center">${t.quantity}</td>
                                                            <td class="min-w-100px text-center">${formatDateTime(t.checkIn)}</td>
                                                            <td class="px-2 min-w-100px text-center">${formatDateTime(t.checkOut)}</td>
                                                        </tr>
                                                    `
                                            }).join("")
                                            }
                                    </tbody>
                                </table>
                                `
            : ""
        }
                        ${data.booking.bookingServices.length > 0 ?
            `
                                    <h3 class="text-uppercase mt-5">Dịch vụ du lịch</h3>
                                    <table class="table table-striped border table-row-bordered gy-5">
                                        <tbody>

                                            <tr class="text-start text-gray-800 fw-boldest fs-7 text-uppercase">
                                                <th class="px-2 min-w-100px">Ngày đi</th>
                                                <th class="px-2 min-w-400px">Tên dịch vụ</th>
                                                <th class="px-2 min-w-100px text-center">Người lớn</th>
                                                <th class="px-2 min-w-100px text-center">Trẻ em</th>
                                            </tr>
                                            ${data.booking.bookingServices.map(t => {
                return `
                                                        <tr>
                                                            <td class="px-2 min-w-100px">${formatDateTime(t.serviceDate)}</td>
                                                            <td class="px-2 min-w-400px">${t.service.name}</td>
                                                            <td class="px-2 min-w-100px text-center">${t.adult}</td>
                                                            <td class="px-2 min-w-100px text-center">${t.child}</td>
                                                        </tr>
                                                    `
                                            }).join("")
                                            }
                                        </tbody>
                                    </table>
                                `
            : ""
        }
                    </div>
                </div>
            </div>
        </div>
        <div class="m-0">
            <div class="border border-dashed border-gray-300 card-rounded h-lg-100 min-w-md-350px p-9 bg-lighten" id="payment-info-${bookingid}">
                <div class="payment-info-col1">
                <h6 class="mb-8 fw-boldest text-gray-600 text-hover-primary">Thông tin thanh toán</h6>
                ${data.banks ?
            `
                            <div class="mb-6">
                                <div class="fw-bold text-gray-600 fs-7">Ngân hàng:</div>
                                <div class="fw-bolder text-gray-800 fs-6">${data.banks.name || ""}</div>
                            </div>

                            <div class="mb-6">
                                <div class="fw-bold text-gray-600 fs-7">Số tài khoản:</div>
                                <div class="fw-bolder text-gray-800 fs-6">
                                    ${data.banks.accountNumber || ""}
                                </div>
                            </div>

                            <div class="mb-15">
                                <div class="fw-bold text-gray-600 fs-7">Chủ tài khoản:</div>
                                <div class="fw-bolder fs-6 text-gray-800 d-flex align-items-center">
                                    ${data.banks.accountName || ""}
                                </div>
                            </div>
                        `
            :
            `
                            <div class="mb-6">
                                <div class="fw-bolder text-gray-800 fs-6 text-danger">Chưa chọn tài khoản ngân hàng mặc định để thanh toán</div>
                            </div>
                        `
        }
                </div>
                <div class="payment-info-col2">
                <h6 class="mb-8 fw-boldest text-gray-600 text-hover-primary">Chính sách thanh toán</h6>
                <div class="mb-6">
                    <h6 class="fw-boldest text-danger">Ghi chú</h6>
                    Tại mục nội dung chuyển khoản, bạn vui lòng ghi thêm "Thanh toan hoa don #${data.booking.code}"
                </div>
                ${data.paymentSchedule ? data.paymentSchedule.map(p => `
                             <div class="mb-6">
                                <div class="fw-bold text-gray-600 fs-7">${p.namePayment}</div>
                                <div class="fw-bolder fs-6 text-gray-800">
                                    ${p.percent}% đơn hàng - ${formatCurrency(p.amount)} VNĐ
                                    <span class="fs-7 text-success d-flex align-items-center">
                                        <span class="bullet bullet-dot bg-success mx-2"></span> Trước ${formatDateTime(p.paymentTerm)}
                                    </span>
                                </div>
                            </div>
                        `).join("")
            : ""
        }
                </div>
            </div>
        </div>
    `
}

const PaymentScheduleDOM = (bookingId, data) => {
    return `
        <div id="payment-schedule-item-${data.id}" class="col-lg-12">
            <div class="d-flex gap-2 mb-5">
             <div class="w-200 w-md-600px">
                <input class="form-control" type="hidden" name="BookingID" value="${bookingId}">
                <input class="form-control" type="hidden" name="ID" value="${data.id}">
                <input class="form-control" name="NamePayment" value="${data.namePayment}" autoComplete="off" placeholder="Tên thanh toán" required/>
            </div>
            <div class="w-200 w-md-200px">
               <input class="form-control" name="Percent" value="${data.percent}" autoComplete="off" placeholder="Tỷ lệ (%)" required/>
            </div>
            <div class="w-200 w-md-200px">
                <input name="PaymentTerm" class="form-control" value="${data.paymentTerm}" autoComplete="off" placeholder="Hạn thanh toán" data-date-time="flatpickr" required/>
            </div>
            <div class="w-200 w-md-200px">
               <input class="form-control input-currency" name="Amount" value="${formatCurrency(data.amount)}" autoComplete="off" placeholder="Số tiền" readonly/>
            </div>
            <div class="w-125 w-md-125px">
                <a class="btn btn-sm btn-icon btn-light-danger" data-id="${data.id}" id="btn-delete-payment-schedule-${data.id}" onclick="DeletePaymentSchedule('${bookingId}','${data.id}')"
                               data-action="data-delete-ticket-code" data-template="false"><i
                                class="fa fa-times"></i></a>
            </div>
</div>

        </div>
    `;
}

const NewPaymentScheduleDOM = (bookingId, newId) => {
    return `
        <div id="payment-schedule-item-${newId}" class="col-lg-12">
            <div class="d-flex gap-2 mb-5">
                <div class="w-200 w-md-600px">
                    <input class="form-control" type="hidden" name="BookingID" value="${bookingId}">
                    <input class="form-control" type="hidden" name="ID" value="${newId}">
                    <input class="form-control" name="NamePayment" autoComplete="off" placeholder="Tên thanh toán" required/>
                </div>
                <div class="w-200 w-md-200px">
                   <input class="form-control" name="Percent" autoComplete="off" placeholder="Tỷ lệ (%)" required/>
                </div>
                <div class="w-200 w-md-200px">
                    <input name="PaymentTerm" class="form-control" autoComplete="off" placeholder="Hạn thanh toán" data-date-time="flatpickr" required/>
                </div>
                <div class="w-200 w-md-200px">
                   <input class="form-control input-currency" name="Amount" autoComplete="off" placeholder="Số tiền" readonly/>
                </div>
                <div class="w-125 w-md-125px">
                    <a href="javascript:void(0);" class="btn btn-sm btn-icon btn-light-danger" data-id="${newId}" id="btn-delete-payment-schedule-${newId}" onclick="DeletePaymentSchedule('${bookingId}','${newId}')" data-template="true"><i class="fa fa-times"></i></a>
                </div>
            </div>
        </div>
    `;
}

const ShowReceiptDOM = (bookingId, receiptDetails) => {
    let isCommission = receiptDetails.receipt.receiptType?.name === "Thanh toán hoa hồng";
    return `
        <tr>
            <td class="pe-0">
                <a
                    class="text-primary"
                    id="btn-${bookingId}-receipt-detail-${receiptDetails.id}"
                    data-bs-stacked-modal="#modal-${bookingId}-receipt-detail"
                    onclick="ShowReceiptDetail(${"'" + bookingId + "'"},${ "'" + receiptDetails.receiptID + "'"});this.onclick = null"
                >
                    ${receiptDetails.receipt.code}
                </a>
            </td>
            <td class="pe-0">${formatDateTime(receiptDetails.receipt.dateCreated)}</td>
            <td class="pe-0">
                <div class="fw-bolder text-gray-600 mb-2">- ${receiptDetails.receipt.receiptGroup?.name}</div>
                <div class="fw-bolder text-gray-600">- ${receiptDetails.receipt.receiptType?.name} ${isCommission?"<i class='icon-flag'></i>":""}</div>
            </td>
            <td class="pe-0">
                <div class="fw-bolder text-gray-600 mb-2">- ${receiptDetails.receipt.status === 1 ? 'Tiền mặt' : 'Chuyển khoản'} </div>
                <div class="fw-bolder text-gray-600">- ${receiptDetails.receipt.bank?.name}</div>
                ${receiptDetails.receivedByPartner ? `<div class="fw-bolder text-gray-600 mt-2">- Đối tác thu hộ - ${receiptDetails.partner.name}</div>` : ''}
                ${receiptDetails.receivedFromPartner ? `<div class="fw-bolder text-gray-600 mt-2">- Thu từ đối tác - ${receiptDetails.partner.name}</div>` : ''}
            </td>
            <td class="pe-0 text-end">
                <div class="fw-bolder">${formatCurrency(receiptDetails.amount)}</div>
            </td>
        </tr>
    `;
}

const ShowReceiptDetailDOM = (bookingId, receiptId, data) => {
    return `
       <div class="mb-3">${data.note ?? ''}</div>
        ${data.accreditationImage ?
           '<div class="mb-3">' +
                '<div class="d-flex justify-content-center">' +
                    `<img src="${data.accreditationImageUrl}" alt="Ủy quyền chi" ` +
                         'class="min-h-60px mh-600px">' +
               ' </div>' +
            '</div>'
        : ''}
        <div class="table-responsive">
            <table class="table align-middle table-row-bordered table-row-dashed gy-5">
                <!--begin::Table body-->
                <tbody>
                <!--begin::Table row-->
                <tr class="text-start text-gray-800 fw-boldest fs-7 text-uppercase">
                    <th class="px-0">Mã đơn hàng</th>
                    <th class="min-w-125px px-0">Ngày tạo</th>
                    <th class="min-w-125px text-end px-0">Só tiền</th>
                </tr>
                <!--end::Table row-->
                ${
                    data.receiptDetails.map(receiptDetail => {
                        return `
                            <tr>
                                <td class="pe-0">
                                    <a href="/Bookings?search=${receiptDetail.booking.code}" target="_blank">
                                        ${receiptDetail.booking.code}
                                    </a>
                                </td>
                                <td class="pe-0">${formatDateTime(receiptDetail.dateCreated)}</td>
                                <td class="pe-0 text-end">
                                    <div class="fw-bolder">${formatCurrency(receiptDetail.amount)}</div>
                                </td>
                            </tr>
                        `
                    }).join("")
                }

                </tbody>
                <!--end::Table body-->
            </table>
        </div>
    `;
}

const ShowPaymentDOM = (bookingId, paymentDetail) => {
    return `
        <tr>
            <td class="pe-0">
                <a
                    class="text-primary"
                    id="btn-${bookingId}-payment-detail-${paymentDetail.id}"
                    data-bs-stacked-modal="#modal-${bookingId}-payment-detail"
                    onclick="ShowPaymentDetail(${"'" + bookingId + "'"},${ "'" + paymentDetail.paymentID + "'"});this.onclick = null"
                >
                    ${paymentDetail.payment.code}
                </a>
            </td>
            <td class="pe-0 w-250">${paymentDetail.partner?.name || ""}</td>
            <td class="pe-0">${formatDateTime(paymentDetail.payment.dateCreated)}</td>
            <td class="pe-0">
                <div class="fw-bolder text-gray-600 mb-2">- ${paymentDetail.payment.paymentGroup?.name}</div>
                <div class="fw-bolder text-gray-600">- ${paymentDetail.payment.paymentType?.name}</div>
            </td>
            <td class="pe-0">
                <div class="fw-bolder text-gray-600 mb-2">- ${paymentDetail.payment.status === 1 ? 'Tiền mặt' : 'Chuyển khoản'} </div>
                <div class="fw-bolder text-gray-600">- ${paymentDetail.payment.bank?.name}</div>
            </td>
            <td class="pe-0 text-end">
                <div class="fw-bolder">${formatCurrency(paymentDetail.amount)}</div>
            </td>
        </tr>

    `;
}

const ShowPaymentDetailDOM = (bookingId, paymentId, payment) => {
    console.log('payment', payment);
    let data = payment.payment;
    return `
        ${
            payment.paymentDefault ? `<div class="mb-3"><strong>Số tiền:</strong> ${formatCurrency(payment.paymentDefault.amount)}</div>` : ''
        }

       <div class="mb-3">${data.note ?? ''}</div>
        ${data.accreditationImage ?
        '<div class="mb-3">' +
        '<div class="d-flex justify-content-center">' +
        `<img src="${data.accreditationImageUrl}" alt="Ủy quyền chi" class="min-h-60px mh-600px">` +
        '</div>' +
        '</div>'
        : ''}
        <div class="table-responsive">
            <table class="table align-middle table-row-bordered table-row-dashed gy-5">
                <thead>
                    <tr class="fw-bolder fs-6 text-gray-800 text-uppercase">
                        <th class="min-w-80px px-2 pb-2">Đơn hàng</th>
                        <th class="min-w-175px pb-2">Đối tác</th>
                        <th class="min-w-175px pb-2">Dịch vụ</th>
                        <th class="min-w-175px text-end pb-2">Tổng tiền</th>
                    </tr>
                </thead>
                <!--begin::Table body-->
                <tbody>
                    ${
                        data.paymentDetails.map(paymentDetail => {
                            return `
                                <tr class="fs-5 align-middle">
                                    <td class="px-2">
                                        <a href="/Bookings?search=${paymentDetail.booking.code}" target="_blank">
                                            ${paymentDetail.booking.code}
                                        </a>
                                    </td>
                                    <td>${paymentDetail.partner?.name || ""}</td>
                                    <td>
                                        <span class="text-gray-800 fw-boldest fs-5 text-hover-primary">
                                            ${paymentDetail.ticketCode?.code || ""}
                                            ${paymentDetail.BbookingHotel?.hotel?.name || ""}
                                            ${paymentDetail.bookingService?.service?.name || ""}
                                        </span>
                                        <span class="text-gray-400 fw-bold d-block">${paymentDetail.identityTypeName || ""}</span>
                                    </td>
                                    <td class="text-end">
                                        <div class="fw-bolder">${formatCurrency(paymentDetail.amount)}</div>
                                    </td>
                                </tr>
                            `
                        }).join("")
                    }
                </tbody>
                <!--end::Table body-->
            </table>
        </div>
    `;
}